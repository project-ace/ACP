Tofu版ACP基本層取扱説明書
===================================================
本文書では、
・環境設定
・ACPライブラリのコンパイル方法
・ACP基本層を利用したアプリケーションのコンパイル方法
・アプリケーションの実行方法
・注意事項
・サンプルプログラムの解説
を記載しています。


環境設定
---------------------------------------------------
buildenv.shの一行目はコンパイラのパスの設定です。
fxlang_home=/opt/FJSVfxlang/1.2.1
の値を環境に合わせ適宜変更してください。


ACPライブラリのコンパイル方法
---------------------------------------------------
acp/以下にACPおよびACPbl/Tofuのソースコードを展開し、
acp/devel/src/bl/tofuディレクトリに移動してください。
makeコマンドでコンパイルできます。
libacpbltofu.soおよびlibacpml.soが生成されます。


ACP基本層を利用したアプリケーションのコンパイル方法
---------------------------------------------------
ラッパスクリプトである makeapp.sh にソースコードを与えてください。
例: ./makeapp.sh atomic.c
中身はmpifccpxを呼び出す単純なスクリプトですので、mpifccpxに与える
オプションを変更したい場合は適宜編集してください。
mpifccpxの使い方に関しては、MPI仕様手引書をお読みください。


アプリケーションの実行方法
---------------------------------------------------
実行にはmpiexecを使用します。
例: mpiexec -of-proc output ./a.out --acp-size-smem 67108864 --acp-size-smem-dl 67108864
完全な例はrun_2nodes.sh, run_3nodes.shをお読みください。


注意事項
---------------------------------------------------
1. 本版のACPライブラリに登録するメモリ領域は、必ず256バイトでアラインされている必要があります。
   256バイトでアラインするには、以下の2つの方法があります。
    i) バッファを確保するときにposix_memalignを使用し、256バイトアラインで確保する。
   ii) 変数に __attribute__((aligned(256))) 属性をつけ、mpifccpxに-Xgを渡してGNU互換モードで
       コンパイルする(makeapp.shはすでに-Xgを渡すように作られています)。
       この方法は、スタック上の変数に対しては無効であり、acp_register_memoryに失敗
       しますので、ご注意ください。

   この制限は、将来のバージョンで解除される予定です。

2. acp_init時に行う同期に実装の誤りがあります。
   FX10では顕在化する事例は今のところありませんが、もしacp_initに入ったままデッドロックしたり
   異常終了するなどの事象がございましたらご連絡をお願いします。


サンプルプログラムの解説
---------------------------------------------------
inifini.c
    ACPライブラリの初期化後、ランク番号の取得を行い、終了する単純なプログラムです。

atomic.c
    アトミック操作に関する簡単なプログラムです。
    run_2nodes.shを用いて実行してください。

remote2remote.c
    リモート間コピーに関する簡単なプログラムです。
    run_3nodes.shを用いて実行してください。
